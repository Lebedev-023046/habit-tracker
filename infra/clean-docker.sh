#!/usr/bin/env bash

set -e

echo "‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –±—É–¥–µ—Ç —É–¥–∞–ª—ë–Ω Docker-–º—É—Å–æ—Ä:"
echo "  ‚Ä¢ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã"
echo "  ‚Ä¢ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å–µ—Ç–∏"
echo "  ‚Ä¢ dangling-–æ–±—Ä–∞–∑—ã (<none>)"
echo "  ‚Ä¢ build cache"
echo "  ‚Ä¢ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ volumes (–≤—Ç–æ—Ä–∞—è –∫–æ–º–∞–Ω–¥–∞)"
echo
read -p "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å? (y/N): " answer

if [[ "$answer" != "y" && "$answer" != "Y" ]]; then
  echo "–û—Ç–º–µ–Ω–∞."
  exit 0
fi

echo "üßπ –û—á–∏—â–∞—é —Å–∏—Å—Ç–µ–º–Ω—ã–π –º—É—Å–æ—Ä (–æ–±—Ä–∞–∑—ã, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, —Å–µ—Ç–∏, –∫—ç—à)..."
docker system prune -af

echo "üßπ –û—á–∏—â–∞—é build cache..."
docker builder prune -af

echo
read -p "–¢–∞–∫–∂–µ —É–¥–∞–ª–∏—Ç—å –ù–ï–ò–°–ü–û–õ–¨–ó–£–ï–ú–´–ï volumes (–º–æ–∂–Ω–æ –ø–æ—Ç–µ—Ä—è—Ç—å –¥–∞–Ω–Ω—ã–µ –ë–î)? (y/N): " vols

if [[ "$vols" == "y" || "$vols" == "Y" ]]; then
  echo "üßπ –û—á–∏—â–∞—é –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ volumes..."
  docker volume prune -f
else
  echo "–ü—Ä–æ–ø—É—Å–∫–∞—é –æ—á–∏—Å—Ç–∫—É volumes."
fi

echo "‚úÖ –ì–æ—Ç–æ–≤–æ. –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:"
docker system df
