generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "darwin-arm64", "linux-musl-arm64-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum HabitStatus {
  planned
  active
  paused
  built
  cancelled
}

enum HabitRunStatus {
  active
  built
  cancelled
}

enum HabitDayStatus {
  completed
  missed
  unmarked
}

model Habit {
  id     String      @id @default(uuid())
  title  String
  status HabitStatus

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  runs HabitRun[]

  @@index([status])
}

model HabitRun {
  id        String @id @default(uuid())
  habitId  String

  status    HabitRunStatus
  totalDays Int

  startDate   DateTime
  builtAt     DateTime?
  cancelledAt DateTime?

  createdAt DateTime @default(now())

  habit   Habit         @relation(fields: [habitId], references: [id], onDelete: Cascade)
  dayLogs HabitDayLog[]

  @@index([habitId])
  @@index([status])

  @@unique([habitId, status], map: "one_active_run_per_habit")
}

model HabitDayLog {
  id         String         @id @default(uuid())
  habitRunId String
  date       DateTime
  status     HabitDayStatus
  createdAt  DateTime       @default(now())

  habitRun HabitRun @relation(fields: [habitRunId], references: [id], onDelete: Cascade)

  @@unique([habitRunId, date])
  @@index([habitRunId])
}
